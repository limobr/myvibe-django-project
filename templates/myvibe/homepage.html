{% extends "myvibe/base.html" %} 
{% load static %} 
{% block content %}
  <!-- Middle Section -->
  <div class="middle-section">
    <!------------------------------------- STORIES HERE--------------------------------------------------->

    <!-- Post Form -->
<div class="create-post" style="display: flex; align-items: center; background-color: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
  <div class="profile-pic" style="margin-right: 10px;">

    {% if user.is_authenticated and user.userprofile.profile_picture %}
    <img src="{{ user.userprofile.profile_picture.url }}" alt="{{ user.first_name }}'s profile picture" style="width: 50px; height: 50px; border-radius: 50%;"/>
{% else %}
    <img src="{% static 'assets/myvibe/images/main-profile.jpg' %}" alt="Default profile picture" style="width: 50px; height: 50px; border-radius: 50%;"/>
{% endif %}
  </div>

  <!-- Clickable input field -->
  <div style="flex: 1;">
    <input type="text" placeholder="What's on your mind?" id="create-post" onclick="window.location.href='{% url 'create_post' %}'" 
           style="width: 100%; padding: 10px; font-size: 1rem; border: 1px solid #d3d3d3; border-radius: 5px; background-color: #fff; cursor: pointer;" readonly />
  </div>
</div>


    {% if posts %}
  <div class="news-feeds">
    {% for post in posts %}
      <div class="feed">
        <div class="head">
          <div class="user">
            <div class="profile-pic">
              {% if post.user.userprofile.profile_picture %}
                <img src="{{ post.user.userprofile.profile_picture.url }}" alt="" />
              {% else %}
                <img src="{% static 'assets/myvibe/images/default_profile.jpg' %}" alt="" />
              {% endif %}
            </div>
            <div class="info">
              <h3>{{ post.user.get_full_name|default:post.user.username }}</h3>
              <small>
                {% if post.short_location %}{{ post.short_location }}, {% endif %}
                {{ post.created_at|timesince }} ago
              </small>
            </div>
            
          </div>
          <span class="edit">
            <i class="fa-solid fa-ellipsis"></i>
          </span>
        </div>

        <div class="caption" style="padding: 5px;">
          <p>
            {{ post.description }}
          </p>
        </div>

        <div class="post-img">
          {% with first_media=post.media_files.all|first %}
            {% if first_media and first_media.media_type == 'image' %}
              <img src="{{ first_media.file.url }}" alt="" />
            {% endif %}
          {% endwith %}
        </div>

        <div class="action-btn">
          <div class="interaction-btn">
            <span><i class="fa-regular fa-heart"></i></span>
            <span><i class="fa-regular fa-comment"></i></span>
            <span><i class="fa-regular fa-paper-plane"></i></span>
          </div>
          <div class="bookmark">
            <span><i class="fa-regular fa-bookmark"></i></span>
          </div>
        </div>

        {% if post.total_likes > 0 %}
        <div class="liked-by">
          {# You might want to loop through a subset of users who liked the post #}
          <span>
            <img src="{% static 'assets/myvibe/images/profile-10.jpg' %}" alt="" />
          </span>
          <span>
            <img src="{% static 'assets/myvibe/images/profile-8.jpg' %}" alt="" />
          </span>
          <span>
            <img src="{% static 'assets/myvibe/images/profile-17.jpg' %}" alt="" />
          </span>
          <p>
            Liked by <b>Amanda Johnson</b> and <b>{{ post.total_likes }} other users.</b>
          </p>
        </div>
        {% endif %}

        

        <div class="comment muted-text">
          {% if post.total_comments > 0 %}
            View all {{ post.total_comments }} Comments
          {% else %}
            Be the first to comment
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p>No posts found.</p>
{% endif %}

  </div>

  
  {% include 'myvibe/rightside.html'%}
</div>

{% endblock %}
