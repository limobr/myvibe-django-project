{% extends "myvibe/base.html" %}
{% load static %}
{% block content %}
<style>
  .create-post {
    display: flex;
    align-items: center;
    background-color: var(--card-bg);
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
    transition: transform 0.2s;
}

.create-post:hover {
    transform: translateY(-2px);
}

.create-post .profile-pic img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
}

.create-post input {
    flex: 1;
    padding: 12px;
    font-size: 1rem;
    border: 1px solid var(--border);
    border-radius: 8px;
    background-color: #f9f9f9;
    cursor: pointer;
    margin-left: 10px;
    transition: border-color 0.3s;
}

.create-post input:hover {
    border-color: var(--primary);
}
</style>
    <!-- Post Creator -->
    <div class="create-post">
      <div class="profile-pic">
          {% if user.is_authenticated and user.userprofile.profile_picture %}
              <img src="{{ user.userprofile.profile_picture.url }}" alt="{{ user.first_name }}'s profile picture" />
          {% else %}
              <img src="{% static 'assets/myvibe/images/main-profile.jpg' %}" alt="Default profile picture" />
          {% endif %}
      </div>
      <input type="text" placeholder="Create a post here?" onclick="window.location.href='{% url 'create_post' %}'"  readonly />
  </div>

    <!-- Posts Feed -->
    {% if posts %}
      <div class="posts-container">
        {% for post in posts %}
          <div class="post-card card" onclick="openPostModal({{ post.id }})">
            <!-- Post Header -->
            <div class="post-header">
              <div class="post-author">
                {% if post.user.userprofile.profile_picture %}
                  <img src="{{ post.user.userprofile.profile_picture.url }}" 
                       class="profile-img" 
                       alt="{{ post.user.username }}">
                {% else %}
                  <img src="{% static 'assets/myvibe/images/default_profile.jpg' %}" 
                       class="profile-img" 
                       alt="Default profile">
                {% endif %}
                <div class="post-meta">
                  <h4 class="author-name">{{ post.user.get_full_name|default:post.user.username }}</h4>
                  <div class="post-info">
                    <span class="post-location">{{ post.short_location }}</span>
                    <span class="post-time">{{ post.created_at|timesince }} ago</span>
                  </div>
                </div>
              </div>
              <button class="post-options">
                <i class="fas fa-ellipsis-v"></i>
              </button>
            </div>

            <!-- Post Content -->
            {% if post.description %}
              <p class="post-caption">{{ post.description }}</p>
            {% endif %}

            <!-- Post Media -->
            {% with first_media=post.media_files.all|first %}
              {% if first_media %}
                <div class="post-media">
                  {% if first_media.media_type == 'image' %}
                    <img src="{{ first_media.file.url }}" 
                         class="post-image" 
                         alt="Post image">
                  {% else %}
                    <video controls class="post-video">
                      <source src="{{ first_media.file.url }}" type="video/mp4">
                    </video>
                  {% endif %}
                </div>
              {% endif %}
            {% endwith %}

            <!-- Post Stats -->
            <div class="post-stats">
              <div class="stat-item">
                <i class="fas fa-heart"></i>
                <span>{{ post.total_likes }}</span>
              </div>
              <div class="stat-item">
                <i class="fas fa-comment"></i>
                <span>{{ post.total_comments }}</span>
              </div>
              <div class="stat-item">
                <i class="fas fa-share"></i>
                <span>{{ post.total_shares }}</span>
              </div>
            </div>

            <!-- Post Actions -->
            <div class="post-actions">
              <button class="post-action like-btn">
                <i class="far fa-heart"></i> Like
              </button>
              <button class="post-action comment-btn">
                <i class="far fa-comment"></i> Comment
              </button>
              <button class="post-action share-btn">
                <i class="far fa-share"></i> Share
              </button>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state card">
        <i class="fas fa-feather"></i>
        <p>No posts found. Be the first to create one!</p>
      </div>
    {% endif %}
{% endblock %}

<div class="modal" id="postModal">
  <div class="modal-content">
      <button class="close-modal">&times;</button>
      <div id="modalContent"></div>
  </div>
</div>

<script>
  var csrfToken = '{{ csrf_token }}';
</script>